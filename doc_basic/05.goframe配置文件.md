# GoFrame配置文件

`GF`的配置管理由`gcfg`模块实现，`gcfg`模块是并发安全的，仅提供配置文件读取功能，不提供数据写入/修改功能，**支持的数据文件格式包括： `JSON`、`XML`、`YAML/YML`、`TOML`、`INI`**，项目中开发者可以灵活地选择自己熟悉的配置文件格式来进行配置管理。

## 一、配置文件

**默认读取执行文件所在目录及其下的`config`目录，默认读取的配置文件为`config.toml`**;`toml`类型文件也是默认的、推荐的配置文件格式，如果想要自定义文件格式，可以通过`SetFileName`方法修改默认读取的配置文件名称（如：`config.json`, `cfg.yaml`, `cfg.xml`, `cfg.ini`等等）。

例如，我们可以通过以下方式读取`config.json`配置文件中的数据库`database`配置项。

```go
// 设置默认配置文件，默认的 config.toml 将会被覆盖
g.Cfg().SetFileName("config.json")
// 后续读取时将会读取到 config.json 配置文件内容，
g.Cfg().Get("database")
```

## 二、读取示例

config.toml

```toml
# 模板引擎目录
viewpath = "/home/www/templates/"
# MySQL数据库配置
[database]
    [[database.default]]
        host     = "127.0.0.1"
        port     = "3306"
        user     = "root"
        pass     = "123456"
        name     = "test1"
        type     = "mysql"
        role     = "master"
        charset  = "utf8"
        priority = "1"
    [[database.default]]
        host     = "127.0.0.1"
        port     = "3306"
        user     = "root"
        pass     = "123456"
        name     = "test2"
        type     = "mysql"
        role     = "master"
        charset  = "utf8"
        priority = "1"
# Redis数据库配置
[redis]
    disk  = "127.0.0.1:6379,0"
    cache = "127.0.0.1:6379,1"
```

main.go

```go
package main

import (
	"fmt"
	"github.com/gogf/gf/frame/g"
)

func main(){
	// /home/www/templates/
	fmt.Println(g.Cfg().Get("viewpath"))

	// 127.0.0.1:6379,1
	c := g.Cfg()
	fmt.Println(c.Get("redis.cache"))

	// test2
	fmt.Println(c.Get("database.default.1.name"))
}

```

go.mod

```go
module gf_config

go 1.14

require github.com/gogf/gf v1.11.6
```

## 三、Toml语法

```toml
title = "TOML 例子"

[owner]
name = "Tom Preston-Werner"
organization = "GitHub"
bio = "GitHub Cofounder & CEO\nLikes tater tots and beer."
dob = 1979-05-27T07:32:00Z # 日期时间是一等公民。为什么不呢？

[database]
server = "192.168.1.1"
ports = [ 8001, 8001, 8002 ]
connection_max = 5000
enabled = true

[servers]
  # 你可以依照你的意愿缩进。使用空格或Tab。TOML不会在意。
  [servers.alpha]
  ip = "10.0.0.1"
  dc = "eqdc10"

  [servers.beta]
  ip = "10.0.0.2"
  dc = "eqdc10"

[clients]
data = [ ["gamma", "delta"], [1, 2] ]

#在数组里换行没有关系。  
hosts = [
  "alpha",
  "omega"
]
```

特点：

- 大小写敏感，必须是`UTF-8`编码
- 注释：`#`

`TOML`主要结构是键值对，与`JSON`类似。值必须是如下类型： `String`, `Integer`, `Float`, `Boolean`, `Datetime`, `Array`, `Table

## 四、自动检测更新

配置管理器使用了缓存机制，当配置文件第一次被读取后会被缓存到内存中，下一次读取时将会直接从缓存中获取，以提高性能。同时，配置管理器提供了对配置文件的**自动检测更新机制**，当配置文件在外部被修改后，配置管理器能够即时地刷新配置文件的缓存内容。

配置管理器的自动检测更新机制是`gf`框架特有的一大特色。